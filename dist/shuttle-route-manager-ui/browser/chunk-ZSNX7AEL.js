import{a as H}from"./chunk-XHCXKUJP.js";import{a as F}from"./chunk-TGDMD2NI.js";import{a as N}from"./chunk-VNNXU67K.js";import"./chunk-K2W5W2RN.js";import{Ba as M,Ga as B,Ka as R,Kb as j,Pb as V,Ra as w,Sa as e,Ta as t,U as $,Ua as x,V as z,W as g,X as k,Xa as I,Ya as _,Za as D,cb as o,d as G,db as C,ta as h,wb as A}from"./chunk-5JI3WXRX.js";var s=G(N());function O(p,i){p&1&&(e(0,"div",30)(1,"div",31),g(),e(2,"svg",32),x(3,"circle",33)(4,"path",34),t(),k(),e(5,"p",35),o(6,"Harita y\xFCkleniyor..."),t()()())}function P(p,i){if(p&1){let n=I();e(0,"div",30)(1,"div",36)(2,"div",37),g(),e(3,"svg",38),x(4,"path",39),t()(),k(),e(5,"h3",40),o(6,"Harita Y\xFCklenemedi"),t(),e(7,"p",41),o(8),t(),e(9,"button",42),_("click",function(){$(n);let a=D();return z(a.loadRoutesData())}),g(),e(10,"svg",43),x(11,"path",44),t(),o(12," Tekrar Dene "),t()()()}if(p&2){let n=D();h(8),C(n.errorMessage)}}function q(p,i){if(p&1){let n=I();e(0,"button",45),_("click",function(){$(n);let a=D();return z(a.toggleRoute(a.selectedRouteIndex))}),g(),e(1,"svg",43),x(2,"path",46),t(),o(3," T\xFCm Rotalar\u0131 G\xF6ster "),t()}}function Y(p,i){p&1&&(e(0,"div",30)(1,"div",36)(2,"div",47),g(),e(3,"svg",48),x(4,"path",10),t()(),k(),e(5,"h3",49),o(6,"Hen\xFCz Rota Yok"),t(),e(7,"p",41),o(8,"\u0130lk rotan\u0131z\u0131 olu\u015Fturarak ba\u015Flay\u0131n!"),t(),e(9,"a",50),g(),e(10,"svg",43),x(11,"path",51),t(),o(12," Yeni Rota Ekle "),t()()())}var W=class p{constructor(i,n,r){this.routeService=i;this.routeStopService=n;this.cdr=r}stats=[];isLoading=!1;errorMessage="";map=null;routesWithStops=[];markers=[];polylines=[];selectedRouteIndex=null;routeColors=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#06B6D4","#84CC16"];ngOnInit(){this.loadStats(),this.loadRoutesData()}ngAfterViewInit(){setTimeout(()=>{this.initMap()},1e3)}loadStats(){this.stats=[{title:"Toplam \u015Eirket",value:12,change:8,icon:"building",color:"blue"},{title:"Aktif S\xFCr\xFCc\xFC",value:48,change:12,icon:"user",color:"green"},{title:"Otob\xFCs Say\u0131s\u0131",value:35,change:5,icon:"bus",color:"purple"},{title:"Aktif Rota",value:24,change:-3,icon:"route",color:"orange"},{title:"Toplam Durak",value:156,change:15,icon:"map-pin",color:"pink"},{title:"G\xFCnl\xFCk Sefer",value:89,change:22,icon:"calendar",color:"indigo"}]}loadRoutesData(){this.isLoading=!0,this.errorMessage="",this.routeService.getAll().subscribe({next:i=>{i.isSuccess&&i.data?this.routeStopService.getAll().subscribe({next:n=>{n.isSuccess&&n.data?(this.matchRoutesWithStops(i.data,n.data),this.isLoading=!1,this.cdr.detectChanges(),this.map&&this.routesWithStops.length>0&&this.drawAllRoutes()):(this.errorMessage="Duraklar y\xFCklenemedi",this.isLoading=!1,this.cdr.detectChanges())},error:()=>{this.errorMessage="Duraklar y\xFCklenirken hata olu\u015Ftu",this.isLoading=!1,this.cdr.detectChanges()}}):(this.errorMessage="Rotalar y\xFCklenemedi",this.isLoading=!1,this.cdr.detectChanges())},error:()=>{this.errorMessage="Rotalar y\xFCklenirken hata olu\u015Ftu",this.isLoading=!1,this.cdr.detectChanges()}})}matchRoutesWithStops(i,n){this.routesWithStops=i.map((r,a)=>{let f=n.filter(c=>c.routeId===r.id).sort((c,y)=>c.sequenceNumber-y.sequenceNumber);return{route:r,stops:f,color:this.routeColors[a%this.routeColors.length]}}).filter(r=>r.stops.length>1)}initMap(){if(!document.getElementById("dashboard-map")){console.error("Map element not found!");return}console.log("Initializing map..."),this.map=s.map("dashboard-map",{center:[41.0082,28.9784],zoom:11}),s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xA9 OpenStreetMap"}).addTo(this.map),console.log("Map initialized"),this.routesWithStops.length>0&&this.drawAllRoutes()}drawAllRoutes(){if(!this.map)return;this.clearMap();let i=null;this.routesWithStops.forEach(n=>{let{route:r,stops:a,color:f}=n;if(a.length<2)return;let c=a.map(d=>[d.latitude,d.longitude]),y=s.polyline(c,{color:f,weight:5,opacity:.8}).addTo(this.map);y.bindPopup(`
        <div style="font-family: sans-serif; min-width: 200px;">
          <h3 style="margin: 0 0 8px 0; color: ${f}; font-size: 16px;">${r.name}</h3>
          <p style="margin: 0; font-size: 13px;">
            <strong>Ba\u015Flang\u0131\xE7:</strong> ${r.startPoint}<br>
            <strong>Biti\u015F:</strong> ${r.endPoint}<br>
            <strong>Duraklar:</strong> ${a.length}
          </p>
        </div>
      `),this.polylines.push(y),a.forEach((d,l)=>{let S=l===0,v=l===a.length-1,b=f,m=32,u=d.sequenceNumber.toString();S?(b="#10B981",m=40,u="\u{1F68C}"):v&&(b="#EF4444",m=40,u="\u{1F3C1}");let L=s.divIcon({className:"custom-div-icon",html:`
            <div style="
              background: ${b};
              width: ${m}px;
              height: ${m}px;
              border-radius: 50%;
              border: 3px solid white;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              display: flex;
              align-items: center;
              justify-content: center;
              color: white;
              font-weight: bold;
              font-size: ${S||v?"18px":"14px"};
            ">${u}</div>
          `,iconSize:[m,m],iconAnchor:[m/2,m/2]}),E=s.marker([d.latitude,d.longitude],{icon:L}).addTo(this.map);E.bindPopup(`
          <div style="font-family: sans-serif; min-width: 220px;">
            <h4 style="margin: 0 0 8px 0; color: ${b}; font-size: 15px;">
              ${d.sequenceNumber}. Durak ${S?"(Ba\u015Flang\u0131\xE7)":v?"(Biti\u015F)":""}
            </h4>
            <p style="margin: 0 0 8px 0; font-size: 12px;">
              <strong>Rota:</strong> ${r.name}
            </p>
            <p style="margin: 0 0 8px 0; font-size: 12px;">
              <strong>Adres:</strong> ${d.address}<br>
              <strong>\u0130l\xE7e:</strong> ${d.district}, ${d.city}
            </p>
            <p style="margin: 0; font-size: 12px;">
              <strong>\u{1F305} Sabah:</strong> ${d.estimatedArrivalTimeMorning||"-"}<br>
              <strong>\u{1F306} Ak\u015Fam:</strong> ${d.estimatedArrivalTimeEvening||"-"}
            </p>
          </div>
        `),this.markers.push(E)}),i?i.extend(s.latLngBounds(c)):i=s.latLngBounds(c)}),i&&this.map&&this.map.fitBounds(i,{padding:[50,50]})}clearMap(){this.markers.forEach(i=>this.map?.removeLayer(i)),this.polylines.forEach(i=>this.map?.removeLayer(i)),this.markers=[],this.polylines=[]}toggleRoute(i){this.selectedRouteIndex===i?(this.selectedRouteIndex=null,this.drawAllRoutes()):(this.selectedRouteIndex=i,this.drawSingleRoute(i))}drawSingleRoute(i){if(!this.map)return;this.clearMap();let n=this.routesWithStops[i],{route:r,stops:a,color:f}=n;if(a.length<2)return;let c=a.map(l=>[l.latitude,l.longitude]),y=s.polyline(c,{color:f,weight:7,opacity:.9}).addTo(this.map);this.polylines.push(y),a.forEach((l,S)=>{let v=S===0,b=S===a.length-1,m=f,u=44,L=l.sequenceNumber.toString();v?(m="#10B981",u=52,L="\u{1F68C}"):b&&(m="#EF4444",u=52,L="\u{1F3C1}");let E=s.divIcon({className:"custom-div-icon",html:`
          <div style="
            background: ${m};
            width: ${u}px;
            height: ${u}px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: ${v||b?"22px":"18px"};
          ">${L}</div>
        `,iconSize:[u,u],iconAnchor:[u/2,u/2]}),T=s.marker([l.latitude,l.longitude],{icon:E}).addTo(this.map);T.bindPopup(`
        <div style="font-family: sans-serif; min-width: 240px;">
          <h4 style="margin: 0 0 8px 0; color: ${m}; font-size: 16px;">
            ${l.sequenceNumber}. Durak ${v?"(Ba\u015Flang\u0131\xE7)":b?"(Biti\u015F)":""}
          </h4>
          <p style="margin: 0 0 8px 0; font-size: 13px;">
            <strong>Rota:</strong> ${r.name}
          </p>
          <p style="margin: 0 0 8px 0; font-size: 13px;">
            <strong>Adres:</strong> ${l.address}<br>
            <strong>\u0130l\xE7e:</strong> ${l.district}, ${l.city}
          </p>
          <p style="margin: 0; font-size: 13px;">
            <strong>\u{1F305} Sabah:</strong> ${l.estimatedArrivalTimeMorning||"-"}<br>
            <strong>\u{1F306} Ak\u015Fam:</strong> ${l.estimatedArrivalTimeEvening||"-"}
          </p>
        </div>
      `),this.markers.push(T)});let d=s.latLngBounds(c);this.map.fitBounds(d,{padding:[80,80]})}getTotalStops(){return this.routesWithStops.reduce((i,n)=>i+n.stops.length,0)}ngOnDestroy(){this.map&&(this.map.remove(),this.map=null)}static \u0275fac=function(n){return new(n||p)(M(F),M(H),M(A))};static \u0275cmp=B({type:p,selectors:[["app-dashboard"]],decls:58,vars:8,consts:[[1,"space-y-6"],[1,"flex","items-start","justify-between","gap-6"],[1,"flex-1"],[1,"text-3xl","font-bold","text-gray-800","dark:text-white"],[1,"text-gray-600","dark:text-gray-400","mt-1"],[1,"flex","gap-3"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow","border","border-gray-200","dark:border-gray-700","p-3","min-w-[100px]"],[1,"flex","items-center","gap-2","mb-1"],[1,"w-8","h-8","rounded","bg-blue-100","dark:bg-blue-900/30","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-blue-600","dark:text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"],[1,"text-xs","text-gray-600","dark:text-gray-400"],[1,"text-xl","font-bold","text-gray-800","dark:text-white"],[1,"w-8","h-8","rounded","bg-green-100","dark:bg-green-900/30","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-green-600","dark:text-green-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z M15 11a3 3 0 11-6 0 3 3 0 016 0z"],[1,"w-8","h-8","rounded","bg-purple-100","dark:bg-purple-900/30","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-purple-600","dark:text-purple-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","border","border-gray-200","dark:border-gray-700","overflow-hidden"],[1,"bg-gray-50","dark:bg-gray-900","px-6","py-3","border-b","border-gray-200","dark:border-gray-700"],[1,"flex","items-center","justify-center","gap-6","flex-wrap"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","rounded-full","bg-green-500","flex","items-center","justify-center","text-white"],[1,"text-sm","text-gray-700","dark:text-gray-300","font-medium"],[1,"w-8","h-8","rounded-full","bg-blue-500","flex","items-center","justify-center","text-white","text-sm","font-bold"],[1,"w-8","h-8","rounded-full","bg-red-500","flex","items-center","justify-center","text-white"],["class","h-[600px] flex items-center justify-center bg-gray-50 dark:bg-gray-900",4,"ngIf"],["id","dashboard-map",1,"h-[600px]","w-full","relative",3,"hidden"],["class","absolute top-4 right-4 z-[1000] bg-white dark:bg-gray-800 text-gray-800 dark:text-white px-4 py-2 rounded-lg shadow-lg hover:shadow-xl transition flex items-center gap-2 border border-gray-200 dark:border-gray-700",3,"click",4,"ngIf"],[1,"h-[600px]","flex","items-center","justify-center","bg-gray-50","dark:bg-gray-900"],[1,"flex","flex-col","items-center","gap-4"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-12","w-12","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-gray-600","dark:text-gray-400","font-medium"],[1,"text-center","max-w-md"],[1,"w-20","h-20","bg-red-100","dark:bg-red-900/30","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-red-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-xl","font-bold","text-gray-800","dark:text-white","mb-2"],[1,"text-gray-600","dark:text-gray-400","mb-6"],[1,"px-6","py-3","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition","flex","items-center","gap-2","mx-auto",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"absolute","top-4","right-4","z-[1000]","bg-white","dark:bg-gray-800","text-gray-800","dark:text-white","px-4","py-2","rounded-lg","shadow-lg","hover:shadow-xl","transition","flex","items-center","gap-2","border","border-gray-200","dark:border-gray-700",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"],[1,"w-24","h-24","bg-blue-100","dark:bg-blue-900/30","rounded-full","flex","items-center","justify-center","mx-auto","mb-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-blue-600","dark:text-blue-400"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white","mb-3"],["routerLink","/routes",1,"inline-flex","items-center","gap-2","px-6","py-3","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-all","shadow-lg"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"]],template:function(n,r){n&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"Dashboard"),t(),e(5,"p",4),o(6,"Genel bak\u0131\u015F ve interaktif rota haritas\u0131"),t()(),e(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),g(),e(11,"svg",9),x(12,"path",10),t()(),k(),e(13,"p",11),o(14,"Rotalar"),t()(),e(15,"p",12),o(16),t()(),e(17,"div",6)(18,"div",7)(19,"div",13),g(),e(20,"svg",14),x(21,"path",15),t()(),k(),e(22,"p",11),o(23,"Duraklar"),t()(),e(24,"p",12),o(25),t()(),e(26,"div",6)(27,"div",7)(28,"div",16),g(),e(29,"svg",17),x(30,"path",18),t()(),k(),e(31,"p",11),o(32,"Seferler"),t()(),e(33,"p",12),o(34),t()()()(),e(35,"div",19)(36,"div",20)(37,"div",21)(38,"div",22)(39,"div",23),o(40,"\u{1F68C}"),t(),e(41,"span",24),o(42,"Ba\u015Flang\u0131\xE7"),t()(),e(43,"div",22)(44,"div",25),o(45,"2"),t(),e(46,"span",24),o(47,"Ara Duraklar"),t()(),e(48,"div",22)(49,"div",26),o(50,"\u{1F3C1}"),t(),e(51,"span",24),o(52,"Son Durak"),t()()()(),R(53,O,7,0,"div",27)(54,P,13,1,"div",27),e(55,"div",28),R(56,q,4,0,"button",29),t(),R(57,Y,13,0,"div",27),t()()),n&2&&(h(16),C(r.routesWithStops.length),h(9),C(r.getTotalStops()),h(9),C(r.routesWithStops.length*2),h(19),w("ngIf",r.isLoading),h(),w("ngIf",r.errorMessage&&!r.isLoading),h(),w("hidden",r.isLoading||r.errorMessage),h(),w("ngIf",r.selectedRouteIndex!==null),h(),w("ngIf",!r.isLoading&&!r.errorMessage&&r.routesWithStops.length===0))},dependencies:[V,j],styles:["#dashboard-map[_ngcontent-%COMP%]{width:100%;height:600px;position:relative;z-index:0}"]})};export{W as DashboardComponent};
